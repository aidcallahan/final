<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drought Awareness</title>

    <!-- Leaflet.js (for the map) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }

        h1 {
            text-align: left;
            padding-top: 20px;
            padding-left: 20px;
        }

        form {
            text-align: center;
            margin: 20px;
        }

        label, select, input {
            margin: 10px;
        }

        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        #advice {
            text-align: center;
            margin-top: 20px;
            font-size: 18px;
        }

        #map {
            height: 500px;
            width: 100%;
        }
    </style>

</head>
<body>

    <h1>Check if Your Area is in Drought (2020)</h1>
    <form id="locationForm">
        <label for="address">Enter your address:</label>
        <input type="text" id="address" name="address" required>

        <label for="month">Select month:</label>
        <select id="month" name="month" required>
            <option value="1">January</option>
            <option value="2">February</option>
            <option value="3">March</option>
            <option value="4">April</option>
            <option value="5">May</option>
            <option value="6">June</option>
            <option value="7">July</option>
            <option value="8">August</option>
            <option value="9">September</option>
            <option value="10">October</option>
            <option value="11">November</option>
            <option value="12">December</option>
        </select>
        
        <button type="submit">Check Drought Status</button>
    </form>

    <div id="map"></div> <!-- Map container -->
    <div id="advice"></div> <!-- Water preservation advice -->

    <script>
        let map; // Declare the map variable outside of the function to ensure global access

        document.getElementById('locationForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const address = document.getElementById('address').value;

            // Simulate geocoding by generating random coordinates for the entered address
            // (In a real application, you'd replace this with actual geocoding)
            const coords = generateRandomCoordinates();
            const lat = coords.lat;
            const lon = coords.lon;

            // Generate random drought diagnosis
            const droughtData = generateRandomDroughtDiagnosis();

            // Display the map with random drought diagnosis
            showMap(lat, lon, droughtData);

            // Show advice based on the random drought data
            displayAdvice(droughtData);
        });

        // Function to generate random coordinates (simulating geocoding)
        function generateRandomCoordinates() {
            // Randomly generate lat/lon within the U.S.
            const lat = 37.7749 + (Math.random() * 10 - 5); // Range: approximately -5 to +5 of San Francisco's latitude
            const lon = -122.4194 + (Math.random() * 10 - 5); // Range: approximately -5 to +5 of San Francisco's longitude
            return { lat, lon };
        }

        // Function to generate a random drought diagnosis
        function generateRandomDroughtDiagnosis() {
            const diagnoses = ['Extreme', 'Moderate', 'Normal'];
            const randomIndex = Math.floor(Math.random() * diagnoses.length);
            return diagnoses[randomIndex];
        }

        // Function to display the map with the random drought diagnosis
        function showMap(lat, lon, droughtData) {
            // If the map already exists, remove it
            if (map) {
                map.remove(); // Remove the existing map
            }

            // Create a new map instance
            map = L.map('map').setView([lat, lon], 10);

            // Use OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            // Add drought-related data to the map (simplified)
            const droughtLayer = L.layerGroup().addTo(map);
            if (droughtData === 'Extreme') {
                L.circle([lat, lon], { color: 'red', radius: 50000 }).addTo(droughtLayer).bindPopup('Extreme Drought');
            } else if (droughtData === 'Moderate') {
                L.circle([lat, lon], { color: 'orange', radius: 50000 }).addTo(droughtLayer).bindPopup('Moderate Drought');
            } else {
                L.circle([lat, lon], { color: 'green', radius: 50000 }).addTo(droughtLayer).bindPopup('Normal Conditions');
            }
        }

        // Function to display water preservation advice
        function displayAdvice(droughtData) {
            const adviceElement = document.getElementById('advice');
            if (droughtData === 'Extreme') {
                adviceElement.innerHTML = "<strong>Extreme Water Preservation Required:</strong> Avoid water-intensive activities, reduce outdoor water usage, and follow local water restrictions.";
            } else if (droughtData === 'Moderate') {
                adviceElement.innerHTML = "<strong>Moderate Water Preservation:</strong> Be mindful of water use, limit lawn watering, and reduce water waste.";
            } else {
                adviceElement.innerHTML = "<strong>Normal Conditions:</strong> No special water preservation practices are needed.";
            }
        }
    </script>

</body>
</html>
